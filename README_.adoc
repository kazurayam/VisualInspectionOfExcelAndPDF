= Patrol: visual inspection of Excel and PDF

== Motivation

A few years ago, I worked for a media company. I was asked to develop a tool software, which is a sort of web scraping tool. The target page is https://www.fsa.go.jp/policy/nisa2/about/tsumitate/target/index.html[this] (is still available to public at MAR 2022). The page looks something like this:

image:./docs/images/01_NISA_target_page.png[alt=target,width=640]

You don't have to understand this page in detail except the following points.

1. The page contains several `<a href="...">` tags to the URLs of Excel files and PDF files.
2. The content of Excel & PDF files are updated by the publisher irregularly. The frequency of updates are not determined. You can track the record: once a month, or once per 2 months.
3. The URL string of Excel/PDF files are fixed. The file names are fixed. You can not tell if the file has been updated by the file name.
4. The publisher does not provide any push-style notification (like https://en.wikipedia.org/wiki/RSS[RSS]) for this page. Those who are interested in the information of this page are asked to keep watching the page, read it and find updates somehow.
5. The company I worked for had a serious interest in the Excel files. Therefore some staffs are asked to visit this page everyday.
6. The staffs hated this job. They wanted some system to automate this bullshit job.

Since then I have worked long to solve this problem. Finally I have got a solution. Let me describe it.

== Problem to solve

The Excel files in the page are irregularly updated, and the publisher does not provided any notification. Therefore my system has to

1. visit the web page regularly and automatically, for example once a day
2. download the current version .xlsx files, compare the content with some previous version to find if there are any updates.
3. If any updates found, take some action. For example, put the newer .xlsx files into some organizational file server and send an E-mail to those who are concerned.

The 1st problem (running a process regularly and automatically) is easy to solve using Linux https://en.wikipedia.org/wiki/Cron[cron], Windows https://docs.microsoft.com/en-us/windows/win32/taskschd/about-the-task-scheduler[Task Scheduler], and some Continuous Integration servers like https://www.jetbrains.com/teamcity/[Team City]. Katalon offers https://www.katalon.com/testops/[Test Ops] of course.

The 3rd problem (taking some actions when your script find it necessary) is easy to solve by your custom programming.

The 2nd problem is difficult. **How can my software detect that the current version of an Excel file is updated? How can my software present visually the difference between the current and previous Excel files?**

I will call this issue **"Patrol for web resources"** for short. The Patrol requires some amount of custom software development.


== Solution

I have developed and published a set of Java/Groovy library to build a Patrol for me and for you.

- https://github.com/kazurayam/materialstore/[materialstore]
- https://github.com/kazurayam/materialstore-mapper/[materialstore-mapper]

And https://github.com/kazurayam/VisualInspectionOfExcelAndPDF[This project] shows a sample built on top of these 2 libraries.

I won't use https://www.fsa.go.jp/policy/nisa2/about/tsumitate/target/index.html[this] as the testbed for demonstration, because 

1. this page is not updated frequent enough. It is updated at most once per a month. I want a testbed updated once per 1 or 2 days.

2. this page is owned by a governmental organization. I do not like to bother them.

Instead I would use the following URL as the testbed for my demonstration:

- https://press.aboutamazon.com/rss/news-releases.xml[Amazon.com, Inc. - Press Room News Releases]

This URL is updated frequently enough, and Amazon would not stop me accessing it a lot using my automation software.

My softoware would do a series of file format conversion: RSS XML -> Excel -> CSV.

== Description



== Demonstration

